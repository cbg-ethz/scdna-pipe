#for f in /cluster/work/bewi/ngs/projects/tumorProfiler/analysis/trial_melanoma/*; do
#  path=$f/singlecell_dna/snake_analysis_files/
#  echo $path

declare -A genders
genders["BSSE_QGF_131049_HNY5VBGXC_1_MADEGOD_T_scD_250c_r1v1_0_SI-GA-E9_S2_L001_I1_001.fastq.gz"]="female"
genders["BSSE_QGF_124091_H5HHTBGXC_1_MADIBUG_T_scD_250c_r1v1_0_SI-GA-F6_S2_L001_I1_001.fastq.gz"]="male"
genders["BSSE_QGF_135165_H3LMTBGXF_1_MADUBIP_T_scD_250c_r1v1_0_SI-GA-B7_S2_L001_I1_001.fastq.gz"]="female"
genders["BSSE_QGF_121434_HJY3FBGXB_1_MAHACEB_T_scD_250c_r1v1_0_SI-GA-B2_S2_L001_I1_001.fastq.gz"]="male"
genders["BSSE_QGF_132264_HTFLNBGXC_1_MAHOBAM_T_scD_250c_r1v1_0_SI-GA-H8_S2_L001_I1_001.fastq.gz"]="male"
genders["BSSE_QGF_124092_H3HFJBGXC_1_MAJOFIJ_T_scD_250c_r1v1_0_SI-GA-G6_S2_L001_I1_001.fastq.gz"]="male"
genders["BSSE_QGF_136663_H5HHCBGXF_1_MALYLEJ_T_scD_250c_r1v1_0_SI-GA-G7_S2_L001_I1_001.fastq.gz"]="female"
genders["BSSE_QGF_124074_H5WYKBGXC_1_MANOFYB_T_scD_250c_r1v1_0_SI-GA-A6_S2_L001_I1_001.fastq.gz"]="male"
genders["BSSE_QGF_119562_HGK7CBGXB_1_MAPOXUB_T_scD_250c_r1v1_0_SI-GA-A3_S2_L001_I1_001.fastq.gz"]="female"
genders["BSSE_QGF_117832_HYHMCBGX9_1_MATIWAQ_T_scD_250c_r1v1_0_SI-GA-A12_S2_L001_I1_001.fastq.gz"]="male"
genders["BSSE_QGF_125791_HC22TBGXC_1_MEHYLOB_T_scD_250c_r1v1_0_SI-GA-H7_S2_L001_I1_001.fastq.gz"]="female"
genders["BSSE_QGF_132558_HVLGNBGXC_1_MEKAKYD_T_scD_250c_r1v1_0_SI-GA-D11_S2_L001_I1_001.fastq.gz"]="female"
genders["BSSE_QGF_124093_H7LNYBGXC_1_MEKOBAB_T_scD_250c_r1v1_0_SI-GA-H6_S2_L001_I1_001.fastq.gz"]="male"
genders["BSSE_QGF_135594_HK5HMDRXX_1_MEMEMUH_T_scD_250c_r1v1_0_SI-GA-H8_S8_L001_I1_001.fastq.gz"]="male"
genders["BSSE_QGF_126141_HCN5FBGXC_1_MENEMAN_T_scD_250c_r1v1_0_SI-GA-G8_S2_L001_I1_001.fastq.gz"]="male"
genders["BSSE_QGF_116935_HYLL5BGX9_1_MENYTEK_T_scD_250c_r1v1_0_SI-GA-A11_S2_L001_I1_001.fastq.gz"]="male"
genders["BSSE_QGF_125342_H7YWKBGXC_1_MEVIXYV_T_scD_250c_r1v1_0_SI-GA-C7_S2_L001_I1_001.fastq.gz"]="male"
genders["BSSE_QGF_121435_HJY3VBGXB_1_MEXUXEH_T_scD_250c_r1v1_0_SI-GA-C2_S2_L001_I1_001.fastq.gz"]="female"
genders["BSSE_QGF_133145_HWY3KBGXC_1_MIBAFUK_T_scD_250c_r1v1_0_SI-GA-E3_S2_L001_I1_001.fastq.gz"]="female"
genders["BSSE_QGF_131047_HNTM7BGXC_1__MIDEKOG_T_scD_250c_r1v1_0_SI-GA-D9_S2_L001_I1_001.fastq.gz"]="female"
genders["BSSE_QGF_116784_HLWH5BGX9_1_MIDOBOL_T_scD_250c_r1v1_0_SI-GA-H5_S1_L001_I1_001.fastq.gz"]="male"
genders["BSSE_QGF_136675_HGFL5BGXF_1_MIGEKUT_T_scD_250c_r1v1_0_SI-GA-H7_S2_L001_I1_001.fastq.gz"]="male"
genders["BSSE_QGF_120521_HG5JCBGXB_1_MIGOFIW_T_scD_250c_r1v1_0_SI-GA-A4_S1_L001_I1_001.fastq.gz"]="female"
genders["BSSE_QGF_115919_HNVJWBGX9_1_MIJUCYK_T_scD_250c_r1v1_0_SI-GA-F8_S4_L001_I1_001.fastq.gz"]="female"
genders["BSSE_QGF_133146_HY2LLBGXC_1_MIKOBID_T_scD_250c_r1v1_0_SI-GA-F3_S2_L001_I1_001.fastq.gz"]="female"
genders["BSSE_QGF_116782_HTWMGBGX9_1_MIKYCYN_T_scD_250c_r1v1_0_SI-GA-H2_S2_L001_I1_001.fastq.gz"]="female"
genders["BSSE_QGF_124094_HC2MCBGXC_1_MISYPUP_T_scD_250c_r1v1_0_SI-GA-A7_S2_L001_I1_001.fastq.gz"]="male"
genders["BSSE_QGF_125714_HC2KNBGXC_1_MOBUBOT_T_scD_250c_r1v1_0_SI-GA-E7_S2_L001_I1_001.fastq.gz"]="female"
genders["BSSE_QGF_123735_H725CBGXC_1_MODUDOL_T_scD_250c_r1v1_0_SI-GA-F5_S2_L001_I1_001.fastq.gz"]="male"
genders["BSSE_QGF_119018_HFGFGBGXB_1_MOFYCAG_T_scD_250c_r1v1_0_SI-GA-H2_S2_L001_I1_001.fastq.gz"]="male"
genders["BSSE_QGF_128980_HNJL5BGXC_1_MOQAVIJ_T_scD_250c_r1v1_0_SI-GA-H4_S2_L001_I1_001.fastq.gz"]="male"
genders["BSSE_QGF_128865_HHLYGBGXC_1_MOTAMUH_T_scD_250c_r1v1_0_SI-GA-E1_S2_L001_I1_001.fastq.gz"]="male"
genders["BSSE_QGF_125792_HCLGNBGXC_1_MOVAZYQ_T_scD_250c_r1v1_0_SI-GA-A8_S2_L001_I1_001.fastq.gz"]="male"
genders["BSSE_QGF_133970_H2HYTBGXF_1_MUBOMEF_T_scD_250c_r1v1_0_SI-GA-H3_S2_L001_I1_001.fastq.gz"]="male"
genders["BSSE_QGF_133969_H2HYMBGXF_1_MUJAGIF_T_scD_250c_r1v1_0_SI-GA-G3_S2_L001_I1_001.fastq.gz"]="female"
genders["BSSE_QGF_131716_HTCGLBGXC_1_MULYMUP_T_scD_250c_r1v1_0_SI-GA-D10_S2_L001_I1_001.fastq.gz"]="male"
genders["BSSE_QGF_132559_HVJLYBGXC_1_MYBYHER_T_scD_250c_r1v1_0_SI-GA-E11_S2_L001_I1_001.fastq.gz"]="male"
genders["BSSE_QGF_132560_HWGVWBGXC_1_MYNELIC_T_scD_250c_r1v1_0_SI-GA-F11_S2_L001_I1_001.fastq.gz"]="female"
genders["BSSE_QGF_125993_HCJTCBGXC_1_MYNESYB_T_scD_250c_r1v1_0_SI-GA-C8_S2_L001_I1_001.fastq.gz"]="male"

for fastq_path in /cluster/work/bewi/ngs/projects/tumorProfiler/analysis/trial_melanoma/*/singlecell_dna/openbis/BSSE*L001_I1_001.fastq.gz;do
  filename=`basename $fastq_path`
  gender="${genders[$filename]}"

  if [ ! -z $gender ]
  then
    dirname="${fastq_path%/*/*/*}"
    sample_id=`basename $dirname`
    echo $sample_id
    output_dir=$dirname/singlecell_dna/snake_analysis_files
    output_file=$output_dir/config_v1.13.json
    # create config
    python /cluster/work/bewi/ngs/projects/tumorProfiler/code/dna-pipeline/scdna-pipe/scripts/create_dnapipeline_config.py -f ${filename} -t melanoma -o ${output_file} --gender ${gender}
    # launch the jobs (you have to manually load the modules and set OMP_NUM_THREADS first)
    cd $output_dir
    bsub -J $sample_id -n 48 -W 23:57 -R fullnode -R "rusage[mem=5000]" snakemake -s /cluster/work/bewi/ngs/projects/tumorProfiler/code/dna-pipeline/scdna-pipe/pipeline/Snakefile ./config_v1.13.json -j 48 -p -k
  fi
done
